<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·ªãch ti√™m</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #ffffff;
            color: #5a5a7a;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff8fb;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(210, 180, 205, 0.3);
            border: 1px solid #f2dae7;
        }
        h1 {
            color: #9c7aa5;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 500;
        }
        h2 {
            color: #9c7aa5;
            margin-top: 25px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #7c668d;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e8d1e4;
            border-radius: 8px;
            box-sizing: border-box;
            background-color: #fefafd;
            color: #6d6a8c;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #c9abda;
            box-shadow: 0 0 0 2px rgba(201, 171, 218, 0.2);
        }
        button {
            background-color: #a588c0;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        button:hover {
            background-color: #8e6cb2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(174, 136, 192, 0.3);
        }
        #results {
            margin-top: 35px;
            display: none;
        }
        .schedule-item {
            background-color: #fcf9ff;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #bda0cf;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(201, 171, 218, 0.15);
        }
        .due {
            border-left-color: #f7a5a5;
        }
        .coming {
            border-left-color: #ffd1a4;
        }
        .complete {
            border-left-color: #aee0bc;
        }
        .vaccine-date {
            font-weight: bold;
        }
        .vaccine-info {
            color: #8e8aa6;
            font-size: 0.9em;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(201, 171, 218, 0.15);
        }
        th, td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #f0e5f5;
        }
        th {
            background-color: #e9ddff;
            color: #6d6a8c;
            font-weight: 500;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:nth-child(even) {
            background-color: #fdf6ff;
        }
        .status-due {
            color: #ed7c7c;
            font-weight: bold;
        }
        .status-coming {
            color: #f5a742;
        }
        .status-complete {
            color: #67c17d;
        }
        #previousVaccines {
            margin-top: 20px;
            display: none;
            background-color: #f8f2ff;
            padding: 15px;
            border-radius: 10px;
        }
        .previous-vaccine {
            margin-bottom: 12px;
            background-color: #f1eaff;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(201, 171, 218, 0.1);
        }
        .remove-btn {
            background-color: #f7a5a5;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            margin-left: 8px;
        }
        .remove-btn:hover {
            background-color: #e97777;
        }
        #addPreviousBtn {
            background-color: #95cfa9;
            margin-bottom: 20px;
        }
        #addPreviousBtn:hover {
            background-color: #7ab98f;
        }
        .tip {
            font-style: italic;
            color: #a097bc;
            font-size: 0.9em;
            margin-top: 6px;
        }
        .alert {
            color: #e97777;
            font-weight: bold;
            font-style: italic;
            margin-top: 6px;
            background-color: #fff2f2;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #f7a5a5;
        }
        input[type="radio"] {
            width: auto;
            margin-right: 5px;
        }
        label[for="hasVaccine"], label[for="noVaccine"] {
            display: inline;
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå∏ L·ªãch ti√™m ch·ªßng cho b√© üå∏</h1>
        
        <div class="form-group">
            <label for="birthdate">Ng√†y sinh c·ªßa b√©:</label>
            <input type="date" id="birthdate" required>
            <p class="tip">Nh·∫≠p ch√≠nh x√°c ng√†y sinh ƒë·ªÉ h·ªá th·ªëng t√≠nh to√°n l·ªãch ti√™m ph√π h·ª£p</p>
        </div>
        
        <div class="form-group">
            <label>ƒê√£ ti√™m c√°c m≈©i vaccine tr∆∞·ªõc ƒë√≥?</label>
            <div>
                <input type="radio" id="hasVaccine" name="previousVaccine" value="yes">
                <label for="hasVaccine" style="display: inline;">C√≥</label>
                
                <input type="radio" id="noVaccine" name="previousVaccine" value="no" checked style="margin-left: 20px;">
                <label for="noVaccine" style="display: inline;">Ch∆∞a</label>
            </div>
        </div>
        
        <div id="previousVaccines">
            <button type="button" id="addPreviousBtn">‚ú® Th√™m m≈©i ti√™m ƒë√£ th·ª±c hi·ªán</button>
            
            <div id="previousVaccinesList"></div>
        </div>
        
        <div class="form-group">
            <label for="parentName">H·ªç t√™n ph·ª• huynh:</label>
            <input type="text" id="parentName" placeholder="Nh·∫≠p h·ªç t√™n ph·ª• huynh">
        </div>
        
        <div class="form-group">
            <label for="contactInfo">Th√¥ng tin li√™n h·ªá (Email ho·∫∑c SƒêT):</label>
            <input type="text" id="contactInfo" placeholder="Nh·∫≠p email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i">
            <p class="tip">H·ªá th·ªëng s·∫Ω g·ª≠i nh·∫Øc nh·ªü khi ƒë·∫øn l·ªãch ti√™m</p>
        </div>
        
        <button type="button" id="calculateBtn">üîç Xem l·ªãch ti√™m</button>
        
        <div id="results">
            <h2>üóìÔ∏è L·ªãch ti√™m ch·ªßng cho b√©</h2>
            <p id="childInfo"></p>
            
            <table id="scheduleTable">
                <thead>
                    <tr>
                        <th>ƒê·ªô tu·ªïi</th>
                        <th>Vaccine</th>
                        <th>Ng√†y ti√™m</th>
                        <th>Tr·∫°ng th√°i</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody"></tbody>
            </table>
            
            <div style="margin-top: 20px; font-size: 0.9em; background-color: #f1eaff; padding: 15px; border-radius: 8px;">
                <p><strong>Ch√∫ √Ω:</strong> L·ªãch ti√™m n√†y ƒë∆∞·ª£c t·∫°o d·ª±a tr√™n l·ªãch ti√™m ch·ªßng m·ªü r·ªông theo Th√¥ng t∆∞ 10/TT-BYT ng√†y 13/6/2024 c·ªßa B·ªô Y t·∫ø. Vui l√≤ng tham kh·∫£o √Ω ki·∫øn b√°c sƒ© ƒë·ªÉ c√≥ l·ªãch ti√™m ph√π h·ª£p nh·∫•t cho tr·∫ª.</p>
                <p>C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: 04/2025</p>
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu vaccine theo l·ªãch ti√™m ch·ªßng m·ªü r·ªông (ƒê√£ c·∫≠p nh·∫≠t theo y√™u c·∫ßu)
        const vaccineSchedule = [
            { age: 0, name: "BCG", disease: "Lao", dose: "M≈©i 1" },
            { age: 0, name: "Vi√™m gan B s∆° sinh", disease: "Vi√™m gan B", dose: "M≈©i 1", maxAgeDays: 7, note: "Ch·ªâ ti√™m trong v√≤ng 7 ng√†y sau sinh" },
            { age: 2, name: "SII", disease: "B·∫°ch h·∫ßu, Ho g√†, U·ªën v√°n, Vi√™m gan B, Hib", dose: "M≈©i 1" },
            { age: 2, name: "OPV", disease: "B·∫°i li·ªát", dose: "M≈©i 1" },
            { age: 2, name: "Rota", disease: "Ti√™u ch·∫£y do Rota virus", dose: "M≈©i 1" },
            { age: 3, name: "SII", disease: "B·∫°ch h·∫ßu, Ho g√†, U·ªën v√°n, Vi√™m gan B, Hib", dose: "M≈©i 2" },
            { age: 3, name: "OPV", disease: "B·∫°i li·ªát", dose: "M≈©i 2" },
            { age: 3, name: "Rota", disease: "Ti√™u ch·∫£y do Rota virus", dose: "M≈©i 2" },
            { age: 4, name: "SII", disease: "B·∫°ch h·∫ßu, Ho g√†, U·ªën v√°n, Vi√™m gan B, Hib", dose: "M≈©i 3" },
            { age: 4, name: "OPV", disease: "B·∫°i li·ªát", dose: "M≈©i 3" },
            { age: 5, name: "IPV", disease: "B·∫°i li·ªát", dose: "M≈©i b·ªï sung 1" },
            { age: 9, name: "IPV", disease: "B·∫°i li·ªát", dose: "M≈©i b·ªï sung 2" },
            { age: 9, name: "S·ªüi", disease: "S·ªüi", dose: "M≈©i 1" },
            { age: 12, name: "Vi√™m n√£o Nh·∫≠t B·∫£n", disease: "Vi√™m n√£o Nh·∫≠t B·∫£n", dose: "M≈©i 1" },
            { daysAfterPrevious: 7, prevVaccine: "Vi√™m n√£o Nh·∫≠t B·∫£n", prevDose: "M≈©i 1", name: "Vi√™m n√£o Nh·∫≠t B·∫£n", disease: "Vi√™m n√£o Nh·∫≠t B·∫£n", dose: "M≈©i 2", isRelativeTiming: true, displayAge: "12 th√°ng" },
            { age: 18, name: "DPT", disease: "B·∫°ch h·∫ßu, Ho g√†, U·ªën v√°n", dose: "M≈©i 4" }, // ƒê√£ s·ª≠a t·ª´ SII th√†nh DPT
            { age: 18, name: "S·ªüi-Rubella", disease: "S·ªüi, Rubella", dose: "M≈©i 1" },
            { age: 24, name: "Vi√™m n√£o Nh·∫≠t B·∫£n", disease: "Vi√™m n√£o Nh·∫≠t B·∫£n", dose: "M≈©i 3" },
            { age: 84, name: "Td", disease: "U·ªën v√°n - B·∫°ch h·∫ßu", dose: "Nh·∫Øc l·∫°i l·∫ßn 1", note: "7 tu·ªïi" }
        ];

        // L·∫•y tham chi·∫øu t·ªõi c√°c ph·∫ßn t·ª≠
        const birthdateInput = document.getElementById('birthdate');
        const hasVaccineRadio = document.getElementById('hasVaccine');
        const noVaccineRadio = document.getElementById('noVaccine');
        const previousVaccinesDiv = document.getElementById('previousVaccines');
        const previousVaccinesList = document.getElementById('previousVaccinesList');
        const addPreviousBtn = document.getElementById('addPreviousBtn');
        const calculateBtn = document.getElementById('calculateBtn');
        const resultsDiv = document.getElementById('results');
        const childInfoP = document.getElementById('childInfo');
        const scheduleBody = document.getElementById('scheduleBody');

        // X·ª≠ l√Ω s·ª± ki·ªán khi ch·ªçn radio button
        hasVaccineRadio.addEventListener('change', function() {
            if (this.checked) {
                previousVaccinesDiv.style.display = 'block';
            }
        });

        noVaccineRadio.addEventListener('change', function() {
            if (this.checked) {
                previousVaccinesDiv.style.display = 'none';
                previousVaccinesList.innerHTML = '';
            }
        });

        // Th√™m m≈©i ti√™m tr∆∞·ªõc ƒë√≥
        addPreviousBtn.addEventListener('click', function() {
            const previousVaccineDiv = document.createElement('div');
            previousVaccineDiv.className = 'previous-vaccine';
            
            // T·∫°o dropdown ch·ªçn vaccine
            const vaccineSelect = document.createElement('select');
            vaccineSelect.className = 'previous-vaccine-name';
            
            // Th√™m c√°c option vaccine
            const uniqueVaccines = [...new Set(vaccineSchedule.map(v => v.name))];
            uniqueVaccines.forEach(vaccine => {
                const option = document.createElement('option');
                option.value = vaccine;
                option.textContent = vaccine;
                vaccineSelect.appendChild(option);
            });
            
            // T·∫°o input ng√†y ti√™m
            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.className = 'previous-vaccine-date';
            dateInput.style.margin = '0 10px';
            
            // T·∫°o n√∫t x√≥a
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.textContent = 'X√≥a';
            removeBtn.addEventListener('click', function() {
                previousVaccinesList.removeChild(previousVaccineDiv);
            });
            
            // T·∫°o dropdown cho li·ªÅu l∆∞·ª£ng
            const doseSelect = document.createElement('select');
            doseSelect.className = 'previous-vaccine-dose';
            
            // Th√™m c√°c option m·∫∑c ƒë·ªãnh cho li·ªÅu l∆∞·ª£ng
            const defaultDoses = ["M≈©i 1", "M≈©i 2", "M≈©i 3", "M≈©i 4", "M≈©i b·ªï sung 1", "M≈©i b·ªï sung 2", "Nh·∫Øc l·∫°i l·∫ßn 1"];
            defaultDoses.forEach(dose => {
                const option = document.createElement('option');
                option.value = dose;
                option.textContent = dose;
                doseSelect.appendChild(option);
            });
            
            // Th√™m c√°c ph·∫ßn t·ª≠ v√†o div
            previousVaccineDiv.appendChild(document.createTextNode('Vaccine: '));
            previousVaccineDiv.appendChild(vaccineSelect);
            previousVaccineDiv.appendChild(document.createTextNode(' Li·ªÅu: '));
            previousVaccineDiv.appendChild(doseSelect);
            previousVaccineDiv.appendChild(document.createTextNode(' Ng√†y ti√™m: '));
            previousVaccineDiv.appendChild(dateInput);
            previousVaccineDiv.appendChild(removeBtn);
            
            // Th√™m div v√†o danh s√°ch
            previousVaccinesList.appendChild(previousVaccineDiv);
            
            // C·∫≠p nh·∫≠t c√°c li·ªÅu l∆∞·ª£ng d·ª±a tr√™n vaccine ƒë∆∞·ª£c ch·ªçn
            vaccineSelect.addEventListener('change', function() {
                updateDoseOptions(vaccineSelect, doseSelect);
            });
            
            // C·∫≠p nh·∫≠t ban ƒë·∫ßu
            updateDoseOptions(vaccineSelect, doseSelect);
        });
        
        // H√†m c·∫≠p nh·∫≠t c√°c li·ªÅu l∆∞·ª£ng d·ª±a tr√™n vaccine ƒë∆∞·ª£c ch·ªçn
        function updateDoseOptions(vaccineSelect, doseSelect) {
            const selectedVaccine = vaccineSelect.value;
            
            // L·ªçc c√°c li·ªÅu duy nh·∫•t cho vaccine ƒë√£ ch·ªçn
            const doses = vaccineSchedule
                .filter(v => v.name === selectedVaccine)
                .map(v => v.dose);
            
            // X√≥a c√°c option hi·ªán t·∫°i
            doseSelect.innerHTML = '';
            
            // Th√™m c√°c option m·ªõi
            doses.forEach(dose => {
                const option = document.createElement('option');
                option.value = dose;
                option.textContent = dose;
                doseSelect.appendChild(option);
            });
            
            // N·∫øu kh√¥ng c√≥ li·ªÅu n√†o, th√™m c√°c li·ªÅu m·∫∑c ƒë·ªãnh
            if (doses.length === 0) {
                const defaultDoses = ["M≈©i 1", "M≈©i 2", "M≈©i 3", "M≈©i 4", "M≈©i b·ªï sung 1", "M≈©i b·ªï sung 2", "Nh·∫Øc l·∫°i l·∫ßn 1"];
                defaultDoses.forEach(dose => {
                    const option = document.createElement('option');
                    option.value = dose;
                    option.textContent = dose;
                    doseSelect.appendChild(option);
                });
            }
        }

        // T√≠nh to√°n l·ªãch ti√™m ch·ªßng
        calculateBtn.addEventListener('click', function() {
            const birthdate = new Date(birthdateInput.value);
            
            if (isNaN(birthdate.getTime())) {
                alert('Vui l√≤ng nh·∫≠p ng√†y sinh h·ª£p l·ªá!');
                return;
            }
            
            // L·∫•y th√¥ng tin c√°c m≈©i ti√™m tr∆∞·ªõc ƒë√≥
            const previousVaccines = [];
            if (hasVaccineRadio.checked) {
                const prevVaccineDivs = document.querySelectorAll('.previous-vaccine');
                prevVaccineDivs.forEach(div => {
                    const vaccineName = div.querySelector('.previous-vaccine-name').value;
                    const vaccineDose = div.querySelector('.previous-vaccine-dose').value;
                    const vaccineDate = div.querySelector('.previous-vaccine-date').value;
                    
                    if (vaccineDate) {
                        previousVaccines.push({
                            name: vaccineName,
                            dose: vaccineDose,
                            date: new Date(vaccineDate)
                        });
                    }
                });
            }
            
            // T√≠nh tu·ªïi hi·ªán t·∫°i t√≠nh theo th√°ng
            const today = new Date();
            const ageInMonths = (today.getFullYear() - birthdate.getFullYear()) * 12 + 
                               (today.getMonth() - birthdate.getMonth());
            
            // Hi·ªÉn th·ªã th√¥ng tin tr·∫ª
            childInfoP.textContent = `B√© sinh ng√†y ${birthdate.toLocaleDateString('vi-VN')} - Hi·ªán ${ageInMonths} th√°ng tu·ªïi`;
            
            // X√≥a c√°c h√†ng c≈© trong b·∫£ng
            scheduleBody.innerHTML = '';
            
            // T·∫°o l·ªãch ti√™m ch·ªßng v·ªõi x·ª≠ l√Ω cho vaccine ph·ª• thu·ªôc
            const processedVaccines = calculateVaccineDates(vaccineSchedule, birthdate, previousVaccines);
            
            // T·∫°o ƒë·ªëi t∆∞·ª£ng ƒë·ªÉ theo d√µi c√°c ƒë·ªô tu·ªïi ƒë√£ hi·ªÉn th·ªã
            const ageDisplayed = {};
            
            // G·ªôp c√°c vaccine c√πng ƒë·ªô tu·ªïi
            const vaccinesByAge = {};
            processedVaccines.forEach(vaccine => {
                let ageKey = '';
                if (vaccine.displayAge) {
                    ageKey = vaccine.displayAge;
                } else if (vaccine.age === 0) {
                    ageKey = 'S∆° sinh';
                } else if (vaccine.age === 24) {
                    ageKey = '24 th√°ng';
                } else if (vaccine.age === 12) {
                    ageKey = '12 th√°ng';
                } else if (vaccine.age >= 12 && vaccine.age % 12 === 0) {
                    const years = vaccine.age / 12;
                    ageKey = `${years} tu·ªïi`;
                } else {
                    ageKey = `${vaccine.age} th√°ng`;
                }
                
                if (!vaccinesByAge[ageKey]) {
                    vaccinesByAge[ageKey] = [];
                }
                vaccinesByAge[ageKey].push(vaccine);
            });
            
            // Hi·ªÉn th·ªã l·ªãch ti√™m theo nh√≥m ƒë·ªô tu·ªïi
            Object.keys(vaccinesByAge).sort((a, b) => {
                // S·∫Øp x·∫øp theo th·ª© t·ª± ƒë·ªô tu·ªïi
                const getAgeInMonths = (ageString) => {
                    if (ageString === 'S∆° sinh') return 0;
                    if (ageString.includes('tu·ªïi')) {
                        return parseInt(ageString) * 12;
                    }
                    return parseInt(ageString);
                };
                return getAgeInMonths(a) - getAgeInMonths(b);
            }).forEach(ageKey => {
                const vaccinesForAge = vaccinesByAge[ageKey];
                let firstRow = true;
                
                vaccinesForAge.forEach(vaccine => {
                    const row = document.createElement('tr');
                    
                    // C·ªôt tu·ªïi/th·ªùi gian - ch·ªâ hi·ªÉn th·ªã m·ªôt l·∫ßn cho m·ªói nh√≥m tu·ªïi
                    const ageCell = document.createElement('td');
                    if (firstRow) {
                        ageCell.textContent = ageKey;
                        // S·ª≠ d·ª•ng rowspan n·∫øu c√≥ nhi·ªÅu vaccine c√πng ƒë·ªô tu·ªïi
                        ageCell.rowSpan = vaccinesForAge.length;
                        firstRow = false;
                    } else {
                        ageCell.style.display = 'none'; // ·∫®n c√°c √¥ tu·ªïi tr√πng l·∫∑p
                    }
                    row.appendChild(ageCell);
                    
                    // C·ªôt vaccine
                    const vaccineCell = document.createElement('td');
                    let vaccineInfo = `<strong>${vaccine.name}</strong><br><span class="vaccine-info">${vaccine.disease} - ${vaccine.dose}</span>`;
                    
                    // Th√™m ch√∫ th√≠ch n·∫øu c√≥
                    if (vaccine.note) {
                        vaccineInfo += `<br><span class="vaccine-info">(${vaccine.note})</span>`;
                    }
                    
                    vaccineCell.innerHTML = vaccineInfo;
                    row.appendChild(vaccineCell);
                    
                    // C·ªôt ng√†y ti√™m
                    const dateCell = document.createElement('td');
                    dateCell.textContent = vaccine.calculatedDate.toLocaleDateString('vi-VN');
                    row.appendChild(dateCell);
                    
                    // Ki·ªÉm tra tr·∫°ng th√°i
                    const statusCell = document.createElement('td');
                    
                    // Ki·ªÉm tra xem vaccine n√†y ƒë√£ ƒë∆∞·ª£c ti√™m ch∆∞a
                    const matchingVaccine = previousVaccines.find(pv => 
                        pv.name === vaccine.name && 
                        pv.dose === vaccine.dose
                    );
                    
                    // Ki·ªÉm tra gi·ªõi h·∫°n tu·ªïi ti√™m cho Vi√™m gan B s∆° sinh
                    let isOutOfWindow = false;
                    if (vaccine.name === "Vi√™m gan B s∆° sinh" && vaccine.maxAgeDays) {
                        const today = new Date();
                        const ageInDays = Math.floor((today - birthdate) / (1000 * 60 * 60 * 24));
                        if (ageInDays > vaccine.maxAgeDays) {
                            isOutOfWindow = true;
                        }
                    }
                    
                    if (matchingVaccine) {
                        statusCell.textContent = 'ƒê√£ ti√™m';
                        statusCell.className = 'status-complete';
                    } else if (isOutOfWindow) {
                        statusCell.textContent = 'ƒê√£ qu√° th·ªùi gian ti√™m';
                        statusCell.className = 'status-due';
                        row.appendChild(statusCell);
                        
                        // Th√™m m·ªôt h√†ng ghi ch√∫
                        const noteRow = document.createElement('tr');
                        const noteCell = document.createElement('td');
                        noteCell.colSpan = 4;
                        noteCell.className = 'alert';
                        noteCell.textContent = 'L∆∞u √Ω: Vaccine Vi√™m gan B s∆° sinh ch·ªâ ti√™m trong v√≤ng 7 ng√†y ƒë·∫ßu sau sinh.';
                        noteRow.appendChild(noteCell);
                        scheduleBody.appendChild(row);
                        scheduleBody.appendChild(noteRow);
                        return; // B·ªè qua vi·ªác th√™m h√†ng th√¥ng th∆∞·ªùng
                    } else if (vaccine.calculatedDate <= today) {
                        statusCell.textContent = 'ƒê·∫øn h·∫°n ti√™m';
                        statusCell.className = 'status-due';
                    } else {
                        // T√≠nh s·ªë ng√†y c√≤n l·∫°i
                        const daysLeft = Math.ceil((vaccine.calculatedDate - today) / (1000 * 60 * 60 * 24));
                        statusCell.textContent = `C√≤n ${daysLeft} ng√†y`;
                        statusCell.className = 'status-coming';
                    }
                    
                    row.appendChild(statusCell);
                    scheduleBody.appendChild(row);
                });
            });
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            resultsDiv.style.display = 'block';
        });

        // H√†m t√≠nh to√°n ng√†y ti√™m cho t·∫•t c·∫£ c√°c vaccine, bao g·ªìm c·∫£ vaccine ph·ª• thu·ªôc
        function calculateVaccineDates(vaccines, birthdate, previousVaccines) {
            const processedVaccines = [];
            const vaccineDoseMap = new Map(); // L∆∞u tr·ªØ th√¥ng tin v·ªÅ vaccine ƒë√£ x·ª≠ l√Ω
            
            // Sao ch√©p m·∫£ng ƒë·ªÉ kh√¥ng ·∫£nh h∆∞·ªüng ƒë·∫øn d·ªØ li·ªáu g·ªëc
            const vaccinesToProcess = [...vaccines];
            
            // X·ª≠ l√Ω t·∫•t c·∫£ c√°c vaccine th√¥ng th∆∞·ªùng (kh√¥ng ph·ª• thu·ªôc)
            for (const vaccine of vaccinesToProcess) {
                if (!vaccine.isRelativeTiming) {
                    const vaccineData = { ...vaccine };
                    
                    // T√≠nh ng√†y ti√™m d·ª± ki·∫øn
                    if (vaccine.ageInDays !== undefined) {
                        // Vaccine ti√™m theo ng√†y sau sinh
                        const calculatedDate = new Date(birthdate);
                        calculatedDate.setDate(birthdate.getDate() + vaccine.ageInDays);
                        vaccineData.calculatedDate = calculatedDate;
                    } else {
                        // Vaccine ti√™m theo th√°ng
                        const calculatedDate = new Date(birthdate);
                        calculatedDate.setMonth(birthdate.getMonth() + vaccine.age);
                        vaccineData.calculatedDate = calculatedDate;
                    }
                    
                    // L∆∞u th√¥ng tin v·ªÅ vaccine ƒë√£ x·ª≠ l√Ω
                    const key = `${vaccine.name}-${vaccine.dose}`;
                    vaccineDoseMap.set(key, vaccineData);
                    
                    processedVaccines.push(vaccineData);
                }
            }
            
            // X·ª≠ l√Ω c√°c vaccine ph·ª• thu·ªôc (sau khi t·∫•t c·∫£ c√°c vaccine th√¥ng th∆∞·ªùng ƒë√£ ƒë∆∞·ª£c t√≠nh)
            for (const vaccine of vaccinesToProcess) {
                if (vaccine.isRelativeTiming) {
                    const vaccineData = { ...vaccine };
                    
                    // T√¨m vaccine ph·ª• thu·ªôc
                    const dependentKey = `${vaccine.prevVaccine}-${vaccine.prevDose}`;
                    const dependentVaccine = vaccineDoseMap.get(dependentKey);
                if (dependentVaccine) {
                        // T√≠nh ng√†y ti√™m d·ª±a tr√™n ng√†y ti√™m c·ªßa vaccine ph·ª• thu·ªôc
                        const dependentDate = dependentVaccine.calculatedDate;
                        const calculatedDate = new Date(dependentDate);
                        calculatedDate.setDate(dependentDate.getDate() + vaccine.daysAfterPrevious);
                        
                        vaccineData.calculatedDate = calculatedDate;
                        
                        // L∆∞u th√¥ng tin v·ªÅ vaccine ƒë√£ x·ª≠ l√Ω
                        const key = `${vaccine.name}-${vaccine.dose}`;
                        vaccineDoseMap.set(key, vaccineData);
                        
                        processedVaccines.push(vaccineData);
                    }
                }
            }
            
            // S·∫Øp x·∫øp k·∫øt qu·∫£ theo ng√†y ti√™m
            return processedVaccines.sort((a, b) => a.calculatedDate - b.calculatedDate);
        }
    </script>
</body>
</html>
